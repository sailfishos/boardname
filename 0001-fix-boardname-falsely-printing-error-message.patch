From 91117541a59b4d7c87c5ae4b434593c7a796d018 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Juho=20H=C3=A4m=C3=A4l=C3=A4inen?= <juho.hamalainen@tieto.com>
Date: Thu, 30 Aug 2012 11:47:05 +0300
Subject: [PATCH 1/2] Fix boardname falsely printing error message.

---
 boardname.c |   13 ++++++++-----
 1 files changed, 8 insertions(+), 5 deletions(-)

diff --git a/boardname.c b/boardname.c
index d129286..828beb2 100644
--- a/boardname.c
+++ b/boardname.c
@@ -14,23 +14,26 @@
 #include "stdlib.h"
 
 #define MAXSTRING 256
+#define BOARDNAME_FILE "/etc/boardname"
 
 char* getboardname()
 {
 	char *buffer;
 	FILE *fd;
 
-	fd = fopen("/etc/boardname", "r");
+	fd = fopen(BOARDNAME_FILE, "r");
 	if (!fd) {
-		fprintf(stderr, "Unable to open /etc/boardname.\n");
+		fprintf(stderr, "Unable to open %s.\n", BOARDNAME_FILE);
 
 		return NULL;
 	}
 
 	buffer = malloc(MAXSTRING);
-	while (!feof(fd))
-		if (fgets(buffer, MAXSTRING, fd) <= 0)
-			fprintf(stderr, "Unable to read from /etc/boardname.\n");
+	if (fgets(buffer, MAXSTRING, fd) == NULL) {
+		fprintf(stderr, "Unable to read from %s.\n", BOARDNAME_FILE);
+		free(buffer);
+		buffer = NULL;
+	}
 
 	fclose(fd);
 
-- 
1.7.0.4

